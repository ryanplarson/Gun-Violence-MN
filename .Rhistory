school[40,6] <- 5
school[41,6] <- 5
school[42,6] <- 2
school[43,6] <- 5
school[44,6] <- 3
school[45,6] <- 5
school[46,6] <- 5
school[47,6] <- 2
school[48,6] <- 5
school[49,6] <- 5
school[50,6] <- 5
school[51,6] <- 0
school[52,6] <- 0
school[53,6] <- 4
school[54,6] <- 5
school[55,6] <- 4
school[56,6] <- 4
school[57,6] <- 4
school[58,6] <- 5
school[59,6] <- 4
school[60,6] <- 4
school[61,6] <- 5
school[62,6] <- 5
school[63,6] <- 5
school[64,6] <- 5
school[65,6] <- 3
school[66,6] <- 0
school[67,6] <- 5
school[68,6] <- 5
school[69,6] <- 5
school[70,6] <- 5
school[71,6] <- 5
school[72,6] <- 5
school[73,6] <- 5
school[74,6] <- 4
school[75,6] <- 5
school[76,6] <- 3
school[77,6] <- 0
school[78,6] <- 0
school[79,6] <- 0
school[80,6] <- 0
school[81,6] <- 0
school[82,6] <- 0
school[83,6] <- 0
school[84,6] <- 0
school[85,6] <- 0
school[86,6] <- 0
school[87,6] <- 5
school[88,6] <- 4
school[89,6] <- 5
school[90,6] <- 5
school[91,6] <- 5
school[92,6] <- 5
school[93,6] <- 5
school[94,6] <- 2
school[95,6] <- 5
school[96,6] <- 3
school[97,6] <- 5
school[98,6] <- 5
school[99,6] <- 2
school[100,6] <- 5
school[101,6] <- 5
school[102,6] <- 5
school[103,6] <- 5
school[104,6] <- 0
school[105,6] <- 0
school[106,6] <- 0
school[107,6] <- 5
school[108,6] <- 4
school[109,6] <- 3
school[110,6] <- 5
school[111,6] <- 5
school[112,6] <- 4
school[113,6] <- 4
school[114,6] <- 5
school[115,6] <- 5
school[116,6] <- 5
school[117,6] <- 5
school[118,6] <- 4
school[119,6] <- 0
school[120,6] <- 5
school[121,6] <- 5
school[122,6] <- 5
school[123,6] <- 5
school[124,6] <- 5
school[125,6] <- 5
school[126,6] <- 5
school[127,6] <- 4
school[128,6] <- 5
school[129,6] <- 0
school[130,6] <- 0
school[131,6] <- 0
school[132,6] <- 0
school[133,6] <- 0
school[134,6] <- 0
school[135,6] <- 0
school[136,6] <- 0
school[137,6] <- 0
school[138,6] <- 0
school[139,6] <- 0
school[140,6] <- 5
school[141,6] <- 4
school[142,6] <- 5
school[143,6] <- 5
school[144,6] <- 5
school[145,6] <- 5
school[146,6] <- 5
school[147,6] <- 2
school[148,6] <- 5
school[149,6] <- 3
school[150,6] <- 5
school[151,6] <- 5
school[152,6] <- 2
school[153,6] <- 5
school[154,6] <- 5
school[155,6] <- 5
school[156,6] <- 5
school[157,6] <- 0
school[158,6] <- 0
school[159,6] <- 5
school[160,6] <- 5
school[161,6] <- 2
school[162,6] <- 5
school[163,6] <- 5
school[164,6] <- 4
school[165,6] <- 4
school[166,6] <- 5
school[167,6] <- 5
school[168,6] <- 5
school[169,6] <- 5
school[170,6] <- 4
school[171,6] <- 0
school[172,6] <- 5
school[173,6] <- 5
school[174,6] <- 5
school[175,6] <- 5
school[176,6] <- 5
school[177,6] <- 5
school[178,6] <- 5
school[179,6] <- 4
school[180,6] <- 5
school[181,6] <- 0
school[182,6] <- 0
school[183,6] <- 0
school[184,6] <- 0
school[185,6] <- 0
school[186,6] <- 0
school[187,6] <- 0
school[188,6] <- 0
school[189,6] <- 0
school[190,6] <- 0
school[191,6] <- 0
school[192,6] <- 0
school[193,6] <- 4
school[194,6] <- 5
school[195,6] <- 5
school[196,6] <- 5
school[197,6] <- 5
school[198,6] <- 5
school[199,6] <- 2
school[200,6] <- 5
school[201,6] <- 4
school[202,6] <- 5
school[203,6] <- 5
school[204,6] <- 5
school[205,6] <- 2
school[206,6] <- 5
school[207,6] <- 5
school[208,6] <- 5
school[209,6] <- 0
school[210,6] <- 0
school[211,6] <- 5
school[212,6] <- 4
school[213,6] <- 4
school[214,6] <- 5
school[215,6] <- 5
school[216,6] <- 5
school[217,6] <- 3
school[218,6] <- 5
school[219,6] <- 5
school[220,6] <- 5
school[221,6] <- 5
school[222,6] <- 4
school[223,6] <- 0
school[224,6] <- 5
school[225,6] <- 5
school[226,6] <- 5
school[227,6] <- 5
school[228,6] <- 5
school[229,6] <- 5
school[230,6] <- 5
school[231,6] <- 4
school[232,6] <- 5
school[233,6] <- 0
school[234,6] <- 0
school[235,6] <- 0
school[236,6] <- 0
school[237,6] <- 0
school[238,6] <- 0
school[239,6] <- 0
school[240,6] <- 0
school[241,6] <- 0
school[242,6] <- 0
school[243,6] <- 0
school[244,6] <- 0
school[245,6] <- 4
school[246,6] <- 5
school[247,6] <- 5
school[248,6] <- 5
school[249,6] <- 5
school[250,6] <- 5
school[251,6] <- 3
school[252,6] <- 4
school[253,6] <- 5
school[254,6] <- 4
school[255,6] <- 5
school[256,6] <- 5
school[257,6] <- 2
school[258,6] <- 5
school[259,6] <- 5
school[260,6] <- 5
school[261,6] <- 0
school[262,6] <- 0
school <- school %>%
mutate(school = days_in_school/days_in_week) %>%
select(year, weekofyr, school)
series <- series %>% left_join(school, by = c("year", "weekofyr"))
ggplot(series)+
geom_line(aes(x=begin_date, y=assault_incid_c))+
scale_x_date(date_labels = "%b-%Y", date_breaks = "6 months")+
geom_vline(xintercept=series$begin_date[series$year==2020 & series$weekofyr==isoweek(date("2020-05-25"))],
linetype="dotted", color="red", size=1)+
geom_label(aes(x=series$begin_date[series$year==2020 & series$weekofyr==isoweek(date("2020-05-25"))],
y=0.050),
label = "George Floyd", show.legend = FALSE)+
labs(title = "Figure 1: Weekly Firearm Assault Injuries, 2016-2020",
subtitle = "MHA Hospital Data",
x = "Week",
y = "Rate per 1,000 Residents")+
theme_minimal()+
theme(axis.text.x=element_text(angle=45, hjust=1))
series <- series %>%
mutate(t = 1:length(assault_incid_c),
post_floyd = as.numeric(begin_date >= as.Date("2020-05-25")),
post_floyd_3 = as.numeric(begin_date >= as.Date("2020-05-25")+months(3)),
stay_at_home = as.numeric(begin_date >= as.Date("2020-03-28") &                                                                                     begin_date <= as.Date("2020-05-28")),
state_of_emerg = as.numeric(begin_date >= as.Date("2020-03-13")),
uof_lag=lag(use_of_force_rate,1),
stops_lag = lag(police_stop_rate,1),
shoot_lag = lag(off_inv_shooting_rate,1))
ts <- lm(assault_incid_c~t+state_of_emerg+stay_at_home+post_floyd+post_floyd_3+
tmax_f+snow_in+precip_in+dark_before_12+school,
data = series)
summary(ts)
acf2(resid(ts), max.lag = 7)
ts_ar1<- lm(assault_incid_c~t+state_of_emerg+stay_at_home+post_floyd+post_floyd_3+
tmax_f+snow_in+precip_in+dark_before_12+school+
dplyr::lag(assault_incid_c, 1), data = series)
summary(ts_ar1)
acf2(resid(ts_ar1), max.lag = 7)
ts_pol <- lm(assault_incid_c~t+state_of_emerg+stay_at_home+post_floyd+post_floyd_3+
tmax_f+snow_in+precip_in+dark_before_12+school+
uof_lag+stops_lag+shoot_lag,
data = series)
summary(ts_pol)
acf2(resid(ts_pol), max.lag = 7)
ts_ar1_pol<- lm(assault_incid_c~t+state_of_emerg+stay_at_home+post_floyd+post_floyd_3+
tmax_f+snow_in+precip_in+dark_before_12+school+
uof_lag+stops_lag+shoot_lag+
dplyr::lag(assault_incid_c, 1), data = series)
summary(ts_ar1_pol)
acf2(resid(ts_ar1_pol), max.lag = 7)
try <- lm(assault_incid_c~t+state_of_emerg+stay_at_home+post_floyd+post_floyd_3+
tmax_f+snow_in+precip_in+dark_before_12+school+
uuse_of_force_rate+police_stop_rate+off_inv_shooting_rate+
dplyr::lag(assault_incid_c, 1), data = series)
try <- lm(assault_incid_c~t+state_of_emerg+stay_at_home+post_floyd+post_floyd_3+
tmax_f+snow_in+precip_in+dark_before_12+school+
use_of_force_rate+police_stop_rate+off_inv_shooting_rate+
dplyr::lag(assault_incid_c, 1), data = series)
summary(try)
summary(ts_ar1_pol)
library(dplyr)
library(tidyr)
library(stringr)
library(readr)
library(lubridate)
library(ggplot2)
library(astsa)
library(tseries)
library(covdata)
library(tidycensus)
library(sf)
library(purrr)
library(imputeTS)
library(rnoaa)
library(ISOweek)
library(ggmap)
library(ggrepel)
library(suncalc)
library(stargazer)
library(tidyquant)
google_key <- readRDS("C:/Users/DELL/Documents/R/Rworkingdirectory/google_api_key.rds")
register_google(key = google_key)
hosp_zcta <- read_csv("minnepop_1620_agg_zipfull_updated.csv") %>%
arrange(zipcode, year, weekofyr) %>%
select(-c(`_chk`, zippop_tag)) %>%
filter(!(year==2016 & weekofyr==53))
hosp_zcta <- read_csv("data/minnepop_1620_agg_zipfull_updated.csv") %>%
arrange(zipcode, year, weekofyr) %>%
select(-c(`_chk`, zippop_tag)) %>%
filter(!(year==2016 & weekofyr==53))
hosp_zcta <- read_csv("Data/minnepop_1620_agg_zipfull_updated.csv") %>%
arrange(zipcode, year, weekofyr) %>%
select(-c(`_chk`, zippop_tag)) %>%
filter(!(year==2016 & weekofyr==53))
hosp_zcta <- read_csv("~Data/minnepop_1620_agg_zipfull_updated.csv") %>%
arrange(zipcode, year, weekofyr) %>%
select(-c(`_chk`, zippop_tag)) %>%
filter(!(year==2016 & weekofyr==53))
library(here)
library(here)
hosp_zcta <- read_csv("~Data/minnepop_1620_agg_zipfull_updated.csv") %>%
arrange(zipcode, year, weekofyr) %>%
select(-c(`_chk`, zippop_tag)) %>%
filter(!(year==2016 & weekofyr==53))
hosp_zcta <- read_csv("Data/minnepop_1620_agg_zipfull_updated.csv") %>%
arrange(zipcode, year, weekofyr) %>%
select(-c(`_chk`, zippop_tag)) %>%
filter(!(year==2016 & weekofyr==53))
getwd()
library(dplyr)
library(tidyr)
library(stringr)
library(readr)
library(lubridate)
library(ggplot2)
library(astsa)
library(tseries)
library(covdata)
library(tidycensus)
library(sf)
library(purrr)
library(imputeTS)
library(rnoaa)
library(ISOweek)
library(ggmap)
library(ggrepel)
library(suncalc)
library(stargazer)
library(tidyquant)
google_key <- readRDS("C:/Users/DELL/Documents/R/Rworkingdirectory/google_api_key.rds")
register_google(key = google_key)
#Covid timelines
#https://docs.google.com/spreadsheets/d/1zu9qEWI8PsOI_i8nI_S29HDGHlIp2lfVMsGxpQ5tvAQ/edit#gid=973655443
hosp_zcta <- read_csv("Gun Violence MN/Data/minnepop_1620_agg_zipfull_updated.csv") %>%
arrange(zipcode, year, weekofyr) %>%
select(-c(`_chk`, zippop_tag)) %>%
filter(!(year==2016 & weekofyr==53))
setwd("C:/Users/DELL/Documents/UMN/UMN Projects/Chris RA/Gun Violence MN")
setwd("C:/Users/DELL/Documents/UMN/UMN Projects/Chris RA/Gun Violence MN")
hosp_zcta <- read_csv("minnepop_1620_agg_zipfull_updated.csv") %>%
arrange(zipcode, year, weekofyr) %>%
select(-c(`_chk`, zippop_tag)) %>%
filter(!(year==2016 & weekofyr==53))
library(dplyr)
library(tidyr)
library(stringr)
library(readr)
library(lubridate)
library(ggplot2)
library(astsa)
library(tseries)
library(covdata)
library(tidycensus)
library(sf)
library(purrr)
library(imputeTS)
library(rnoaa)
library(ISOweek)
library(ggmap)
library(ggrepel)
library(suncalc)
library(stargazer)
library(tidyquant)
google_key <- readRDS("C:/Users/DELL/Documents/R/Rworkingdirectory/google_api_key.rds")
register_google(key = google_key)
#Covid timelines
#https://docs.google.com/spreadsheets/d/1zu9qEWI8PsOI_i8nI_S29HDGHlIp2lfVMsGxpQ5tvAQ/edit#gid=973655443
hosp_zcta <- read_csv("C:/Users/DELL/Documents/UMN/UMN Projects/Chris RA/Gun Violence MN/Data/minnepop_1620_agg_zipfull_updated.csv") %>%
arrange(zipcode, year, weekofyr) %>%
select(-c(`_chk`, zippop_tag)) %>%
filter(!(year==2016 & weekofyr==53))
hosp_zcta <- read_csv("C:/Users/DELL/Documents/UMN/UMN Projects/Chris RA/Gun Violence MN/Restricted Hospital Data/minnepop_1620_agg_zipfull_updated.csv") %>%
arrange(zipcode, year, weekofyr) %>%
select(-c(`_chk`, zippop_tag)) %>%
filter(!(year==2016 & weekofyr==53))
hosp_zcta <- read_csv("Restricted Hospital Data/minnepop_1620_agg_zipfull_updated.csv") %>%
arrange(zipcode, year, weekofyr) %>%
select(-c(`_chk`, zippop_tag)) %>%
filter(!(year==2016 & weekofyr==53))
hosp_zcta <- read_csv("~Restricted Hospital Data/minnepop_1620_agg_zipfull_updated.csv") %>%
arrange(zipcode, year, weekofyr) %>%
select(-c(`_chk`, zippop_tag)) %>%
filter(!(year==2016 & weekofyr==53))
hosp_zcta <- read_csv("Restricted Hospital Data/minnepop_1620_agg_zipfull_updated.csv") %>%
arrange(zipcode, year, weekofyr) %>%
select(-c(`_chk`, zippop_tag)) %>%
filter(!(year==2016 & weekofyr==53))
library(here)
here::here("C:/Users/DELL/Documents/UMN/UMN Projects/Chris RA/Gun Violence MN")
hosp_zcta <- read_csv("Restricted Hospital Data/minnepop_1620_agg_zipfull_updated.csv") %>%
arrange(zipcode, year, weekofyr) %>%
select(-c(`_chk`, zippop_tag)) %>%
filter(!(year==2016 & weekofyr==53))
get_wd()
getwd()
setwd("C:/Users/DELL/Documents/UMN/UMN Projects/Chris RA/Gun Violence MN")
hosp_zcta <- read_csv("/Restricted Hospital Data/minnepop_1620_agg_zipfull_updated.csv") %>%
arrange(zipcode, year, weekofyr) %>%
select(-c(`_chk`, zippop_tag)) %>%
filter(!(year==2016 & weekofyr==53))
hosp_zcta <- read_csv("~/Restricted Hospital Data/minnepop_1620_agg_zipfull_updated.csv") %>%
arrange(zipcode, year, weekofyr) %>%
select(-c(`_chk`, zippop_tag)) %>%
filter(!(year==2016 & weekofyr==53))
library(dplyr)
library(tidyr)
library(stringr)
library(readr)
library(lubridate)
library(ggplot2)
library(astsa)
library(tseries)
library(covdata)
library(tidycensus)
library(sf)
library(purrr)
library(imputeTS)
library(rnoaa)
library(ISOweek)
library(ggmap)
library(ggrepel)
library(suncalc)
library(stargazer)
library(tidyquant)
library(here)
google_key <- readRDS("C:/Users/DELL/Documents/R/Rworkingdirectory/google_api_key.rds")
register_google(key = google_key)
hosp_zcta <- read_csv("~/Restricted Hospital Data/minnepop_1620_agg_zipfull_updated.csv") %>%
arrange(zipcode, year, weekofyr) %>%
select(-c(`_chk`, zippop_tag)) %>%
filter(!(year==2016 & weekofyr==53))
hosp_zcta <- read_csv("/Restricted Hospital Data/minnepop_1620_agg_zipfull_updated.csv") %>%
arrange(zipcode, year, weekofyr) %>%
select(-c(`_chk`, zippop_tag)) %>%
filter(!(year==2016 & weekofyr==53))
hosp_zcta <- read_csv("Restricted Hospital Data/minnepop_1620_agg_zipfull_updated.csv") %>%
arrange(zipcode, year, weekofyr) %>%
select(-c(`_chk`, zippop_tag)) %>%
filter(!(year==2016 & weekofyr==53))
getwd()
here("C:/Users/DELL/Documents/UMN/UMN Projects/Chris RA/Gun Violence MN")
hosp_zcta <- read_csv("Restricted Hospital Data/minnepop_1620_agg_zipfull_updated.csv") %>%
arrange(zipcode, year, weekofyr) %>%
select(-c(`_chk`, zippop_tag)) %>%
filter(!(year==2016 & weekofyr==53))
getwd()
library(dplyr)
library(tidyr)
library(stringr)
library(readr)
library(lubridate)
library(ggplot2)
library(astsa)
library(tseries)
library(covdata)
library(tidycensus)
library(sf)
library(purrr)
library(imputeTS)
library(rnoaa)
library(ISOweek)
library(ggmap)
library(ggrepel)
library(suncalc)
library(stargazer)
library(tidyquant)
google_key <- readRDS("C:/Users/DELL/Documents/R/Rworkingdirectory/google_api_key.rds")
register_google(key = google_key)
#Covid timelines
#https://docs.google.com/spreadsheets/d/1zu9qEWI8PsOI_i8nI_S29HDGHlIp2lfVMsGxpQ5tvAQ/edit#gid=973655443
hosp_zcta <- read_csv("Restricted Hospital Data/minnepop_1620_agg_zipfull_updated.csv") %>%
arrange(zipcode, year, weekofyr) %>%
select(-c(`_chk`, zippop_tag)) %>%
filter(!(year==2016 & weekofyr==53))
hosp_zcta <- read_csv("Restricted Hospital Data/minnepop_1620_agg_zipfull_updated.csv") %>%
arrange(zipcode, year, weekofyr) %>%
select(-c(`_chk`, zippop_tag)) %>%
filter(!(year==2016 & weekofyr==53))
hosp_zcta <- read_csv("minnepop_1620_agg_zipfull_updated.csv") %>%
arrange(zipcode, year, weekofyr) %>%
select(-c(`_chk`, zippop_tag)) %>%
filter(!(year==2016 & weekofyr==53))
hosp_zcta <- read_csv("Restricted Hospital Data/minnepop_1620_agg_zipfull_updated.csv") %>%
arrange(zipcode, year, weekofyr) %>%
select(-c(`_chk`, zippop_tag)) %>%
filter(!(year==2016 & weekofyr==53))
#minneapolis shapefile (source: openminneapolis.gov)
mpls <- st_read("Data/mpls_city-shp/16cdbbfa-ad10-493c-afaf-52b61f2e76e42020329-1-180h9ap.whbo.shp") %>%
st_set_crs(st_crs(zcta))
mpls <- st_read("Data/mpls_city-shp/16cdbbfa-ad10-493c-afaf-52b61f2e76e42020329-1-180h9ap.whbo.shp")
